<!DOCTYPE html>
<html lang = "en">
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <script src="SavedLevel.js"></script>
</head>
<body>
    <canvas id="gameCanvas" width = "2000" height="2200" ></canvas>
    <button  onclick = "ShowOutput();" style = "width: 100px; top: 100px; left: 2100px; position: absolute;">OUTPUT</button>
    <button  onclick = "CopyOutputToClipboard();" style = "width: 100px; top: 130px; left: 2100px; position: absolute;">COPY</button>
    <button  onclick = "LoadSavedLevel();"style = "width: 100px; top: 160px; left: 2100px; position: absolute;">LOAD</button>
    <p id="output" style = "position: absolute; left: 2230px; top: 100px; font-size: 12pt; line-height: 14px"></p> 
</body>
<script>
var MAP = new Array (200*200);
var OutStrToClipBoard = "";
window.onload = function() {
    canvas = document.getElementById('gameCanvas');

    canvas.style.left = "100px";
    canvas.style.top = "100px";
    canvas.style.position = "absolute";

    canvas.addEventListener('contextmenu', function(evt) { 
        evt.preventDefault();
    }, false);

    document.addEventListener('mousedown', MouseDownHandler);
    document.addEventListener('mouseup', MouseUpHandler);
    document.addEventListener('mousemove', updateMousePos);
    for (let i = 0;i<MAP.length;i++){
        MAP[i] = false;
    }
    canvas.focus();
    canvasContext = canvas.getContext('2d');
    

    var framesPerSecond = 60;
    setInterval(Main, 1000/framesPerSecond);
}

function LoadSavedLevel(){
    MAP = GetSavedLevel();
}

function ShowOutput(){
    var OutStrToScreen = "[";
    OutStrToClipBoard = "[";
    var counter = 0;

    for (let i = 0;i<MAP.length;i++){
        if (counter == 200){
            OutStrToScreen += "\n";
            counter = 0;
        }
        if(MAP[i]){
            OutStrToScreen += "1,";
            OutStrToClipBoard += "1,";
        }
        else {
            OutStrToScreen += "0,";
            OutStrToClipBoard += "0,";
        }
        counter++;
    }
    OutStrToScreen += "]"
    OutStrToClipBoard += "]"
    document.getElementById('output').innerHTML = OutStrToScreen;
    

    console.log("MAP.length = "+MAP.length);
}
function CopyOutputToClipboard(){
    if(OutStrToClipBoard == ""){
        window.alert("Output string is empty");
    }
    else if(OutStrToClipBoard != ""){
        navigator.clipboard.writeText(OutStrToClipBoard);
        window.alert("Copied to Clipboard");
    }
}
function Main (){
    
    colorRect(0,0,canvas.width,canvas.height,"#d3fff6");
    colorRect(mouseX-5,mouseY-5,10,10,"#4286f4");
    colorLine(0,0,0,canvas.height-200,"#000000",3);
    colorLine(0,canvas.height-200,canvas.width,canvas.height-200,"#000000",3);
    colorLine(canvas.width,canvas.height-200,canvas.width,0,"#000000",3);
    colorLine(canvas.width,0,0,0,"#000000",3);


    drawMap();
    colorText(Math.floor(mouseX) + "," + Math.floor(mouseY),mouseX+20,mouseY+50,"#000000","30px Arial ");
    colorText(Math.floor(mouseX) + "," + Math.floor(mouseY),100,canvas.height-100,"#000000","40px Arial ");
}


function drawMap(){
    for (let i = 0;i<200;i++){
        for (let j = 0;j<200;j++){
            if (MAP[i*200+j])colorRect(j*10,i*10,10,10,"#4286f4");
        }
    }
}



/* MOUSE EVENT LISTENERS */
var keyLMouse = false;
var keyRMouse = false;
var mouseX = 0;
var mouseY = 0;

function MouseDownHandler (evt){
    if (evt.button == 0) {
        keyLMouse = true;
        editTile(true);
    }
    else if(evt.button == 2) {
        keyRMouse = true;
        editTile(false);
    }
}

function MouseUpHandler (evt){
    if(evt.button == 0){
        keyLMouse = false;
        
        
    }
    else if(evt.button == 2){
        keyRMouse = false;
    }
}

function updateMousePos (evt){
    var rect = canvas.getBoundingClientRect();
    var root = document.documentElement;
    mouseX = evt.clientX - rect.left ;
    mouseY = evt.clientY - rect.top;

    
    if (keyLMouse){
        editTile(true);
    }
    if(keyRMouse){
        editTile(false);
    }
      
}
function editTile(setto){
    var MouseIsOnTiles = CheckIfMouseIsOnTiles();
    if(MouseIsOnTiles){
        MAP[(Math.floor(mouseY/10))*200+(Math.floor(mouseX/10))] = setto;
        console.log("MAP["+(Math.floor(mouseX/10))+","+Math.floor(mouseY/10)*200+"] set to: "+setto);
    }
    
}
function CheckIfMouseIsOnTiles(){
    if( (mouseX>0&&mouseX<2000)&&
        (mouseY>0&&mouseY<2000))return true;
    else return false;
}

/* DRAWING */
function colorRect(topLeftX,topLeftY, boxWidth, boxHeight, fillColor){
    canvasContext.fillStyle = fillColor;
    canvasContext.fillRect (topLeftX,topLeftY, boxWidth,boxHeight);
}
function colorText(showWords, textX, textY, fillColor,font,align = "start"){
    canvasContext.fillStyle = fillColor;
    canvasContext.font = font;
    canvasContext.textAlign=align;
    canvasContext.fillText(showWords,textX,textY);
}
function colorLine (startX,startY,endX,endY,strokeColor,strokeWidth){
    canvasContext.strokeStyle = strokeColor;
    canvasContext.lineWidth = strokeWidth;
    canvasContext.beginPath();
    canvasContext.moveTo(startX,startY);
    canvasContext.lineTo(endX,endY);
    canvasContext.stroke();
}




</script>

</html>


